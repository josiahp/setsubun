pico-8 cartridge // http://www.pico-8.com
version 39
__lua__
function _init()
 debug=true
 
 t=time()
 --dad is 24 pixels tall, so
 -- 1.5m == 24px
 -- 9.8m == 156px?
 gravity=9.81*2
 dt=0
 drag=0.1
 --dad=init_dad(63,63)
 beans_init()
 --bg=beans_new(63,63,5)
 target_init()
 
 tar=target_new(63,63)
end

function _update()
 local tt=time()
 dt=tt-t
 t=tt
 
 tar:update(dt)
 
 if btn(⬆️) then
  tar.basey-=2
 elseif btn(⬇️) then
  tar.basey+=2
 end
 
 if btn(⬅️) then
  tar.basex-=2
 elseif btn(➡️) then
  tar.basex+=2
 end
 
 --debug throw beans
 if debug then
	 if btnp(❎) then
	  local vx,vy=vtoward(tar.x,tar.y,40,80)
	  bg=beans_new(40,80,5,vx,vy)
	 end
	end
 
 --dad:update(dt)
 --beans:update(dt)
 
 if bg then
  bg:update(dt)
 end
end

function _draw()
 cls()
 tar:draw()
 if debug then
  circ(40,80,3,8)
  print("throw from here",10,85,6)
 end
 --dad:draw()
 if bg then
  bg:draw()
 end
end
-->8
--dad

function init_dad(x,y)
 local dad={
  x=63,
  y=63,
  spd=50,
  update=function(d,dt)
   local vx,vy=0,0
   if btn(⬅️) then
    vx-=d.spd
   elseif btn(➡️) then
    vx+=d.spd
   end
   d.x+=vx*dt
   d.y+=vy*dt
  end,
  draw=function(d)
   spr(1,d.x,d.y,2,3,false,false)
  end,
 }
 return dad
end
-->8
function vtoward(x1,y1,x2,y2)
 local vx,vy=x1-x2,y1-y2
 local len=sqrt(vx^2+vy^2)
 vx/=len
 vy/=len
 return vx,vy
end
-->8
--beans
function beans_init()
 beans_proto={
  update=function(b,dt)
   for k,v in pairs(b.group) do
    if not v.grounded then
	    --gravity
	    v.vy+=gravity*dt
	   end
   
    if v.y+v.vy*dt>=127 then
     v.vy*=-1
    end
    
    --add drag to reduce
    -- velocity over time
    v.vx*=1-drag
    v.vy*=1-drag
    
    --if the bean is close to
    -- to the ground and low
    -- velocity, lets stop
    -- the physics
    if abs(v.vy)<1 and abs(127-v.y+v.vy)<5 then
     v.y=127
     v.vy=0
     v.grounded=true
    end

    v.y+=v.vy
    v.x+=v.vx
   end   
  end,
  draw=function(b)
   for k,v in pairs(b.group) do
    spr(3,v.x-4,v.y-4)
   end
  end,
 }
 beans_meta={__index=beans_proto}
end

function beans_new(x,y,n,vx,vy)
 local beans={
  group={},
 }
 for n=1,n do
  add(beans.group,{
   x=x+rnd(10)-5,
   y=y+rnd(10)-5,
   
   -- initial bean velocity
   vx=vx*8,
   vy=vy*8,
   
   grounded=false,
  })
 end
 setmetatable(beans,beans_meta)
 return beans
end
-->8
--targeting
function target_init()
 target_proto={
  update=function(t,dt)
   t.txo=cos(time())*20
   t.tyo=sin(time())*5
   
   t.x=t.basex+t.txo
   t.y=t.basey+t.tyo
  end,
  draw=function(t)
   spr(4,t.x-4,t.y-4)
  end,
 }
 target_meta={__index=target_proto}
end

function target_new(x,y)
 local t={
  --these are calculcated from
  --base+offset (basex+txo)
  x=x,
  y=y,
  
  basex=x,
  basey=y,
  txo=0,
  tyo=0
 }
 setmetatable(t,target_meta)
 return t
end
__gfx__
00000000000077000077000000000000707777070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000077000077000000000000070000700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007000007ee7007ee70000004f000707007070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000007ee7007ee700000f4ff00700000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000007ee7777ee700000ff4f00700000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007000007ee7777ee7000000ff000707007070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000007777777777770000000000070000700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777777777777000000000707777070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777777777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777777777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777777777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000007777777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000677777777600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000767777776700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000007776666667770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000007777777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000007777777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000777777777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000777777777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000777777777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000077700777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000077700777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000777700777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000777000077700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
